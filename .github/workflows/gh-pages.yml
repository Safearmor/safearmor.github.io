name: Deploy MkDocs Docs

on:
  push:
    branches:
      - main

jobs:
  deploy-docs:
    runs-on: ubuntu-latest

    steps:
      # Passo 1: Fazer checkout do repositório
      - uses: actions/checkout@v3

      # Passo 2: Configurar Python
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.x

      # Passo 3: Instalar MkDocs e tema Material
      - name: Install MkDocs
        run: pip install --upgrade pip mkdocs mkdocs-material

      # Passo 4: Build do site, removendo arquivos antigos
      - name: Build MkDocs site
        run: mkdocs build --clean

      # Passo 5: Deploy para /docs
      - name: Deploy to /docs
        env:
          GH_PAT: ${{ secrets.GH_PAT }}  # Personal Access Token com permissão de escrita
        run: |
          # Remove a pasta docs antiga
          rm -rf docs
          # Move o site gerado para /docs
          mv site docs
          # Configura usuário Git para o commit
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          # Commit apenas se houver alterações
          git add docs
          git diff --cached --quiet || git commit -m "Update MkDocs docs"
          # Push usando o Personal Access Token para evitar erro 403
          git push https://x-access-token:${GH_PAT}@github.com/Safearmor/safearmor.github.io.git main
